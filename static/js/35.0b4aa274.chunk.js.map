{"version":3,"sources":["hooks/useResizeObserver.js","components/TimeseriesBrush.js"],"names":["useResizeObserver","ref","useState","dimensions","setDimensions","useEffect","observeTarget","current","resizeObserver","ResizeObserver","entries","observer","forEach","entry","index","contentRect","observe","unobserve","margin","TimeseriesBrush","timeseries","dates","brushDomain","endDate","setBrushEnd","setLookback","chartRef","useRef","wrapperRef","getBoundingClientRect","width","height","xScale","useMemo","T","length","chartRight","scaleTime","clamp","domain","parseIndiaDate","range","chartBottom","timeseriesStacked","stack","keys","BRUSH_STATISTICS","value","date","statistic","Math","max","getStatistic","yScale","scaleLinear","svg","select","t","transition","duration","D3_TRANSITION_DURATION","attr","style","call","g","axisBottom","ticks","numTicksX","areaPath","area","curve","curveMonotoneX","x","d","data","y0","y1","selectAll","join","enter","append","key","STATISTIC_CONFIGS","color","update","attrTween","previous","this","interpolatePath","selection","defaultSelection","map","brushed","useCallback","sourceEvent","invert","brushStartDate","brushEndDate","ReactDOM","unstable_batchedUpdates","formatISO","representation","differenceInDays","beforebrushstarted","event","brushSelection","parentNode","dx","pointers","cx","x0","x1","X0","X1","brush","move","brushX","extent","on","datum","type","className","classnames","preserveAspectRatio","isEqual","prevProps","currProps","equal","regionHighlighted","stateCode","districtName","memo"],"mappings":"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","file":"static/js/35.0b4aa274.chunk.js","sourcesContent":["import {ResizeObserver} from '@juggle/resize-observer';\nimport {useState, useEffect} from 'react';\n\nexport const useResizeObserver = (ref) => {\n  const [dimensions, setDimensions] = useState(null);\n  useEffect(() => {\n    const observeTarget = ref.current;\n    const resizeObserver = new ResizeObserver((entries, observer) => {\n      entries.forEach((entry, index) => {\n        setDimensions(entry.contentRect);\n      });\n    });\n    resizeObserver.observe(observeTarget);\n    return () => {\n      resizeObserver.unobserve(observeTarget);\n    };\n  }, [ref]);\n  return dimensions;\n};\n\nexport default useResizeObserver;\n","import {\n  BRUSH_STATISTICS,\n  D3_TRANSITION_DURATION,\n  STATISTIC_CONFIGS,\n} from '../constants';\nimport {useResizeObserver} from '../hooks/useResizeObserver';\nimport {getStatistic, parseIndiaDate} from '../utils/commonFunctions';\n\nimport classnames from 'classnames';\nimport {max} from 'd3-array';\nimport {axisBottom} from 'd3-axis';\nimport {brushX, brushSelection} from 'd3-brush';\nimport {interpolatePath} from 'd3-interpolate-path';\nimport {scaleTime, scaleLinear} from 'd3-scale';\nimport {select, pointers} from 'd3-selection';\nimport {area, curveMonotoneX, stack} from 'd3-shape';\nimport 'd3-transition';\nimport {differenceInDays, formatISO} from 'date-fns';\nimport equal from 'fast-deep-equal';\nimport {memo, useCallback, useMemo, useEffect, useRef} from 'react';\nimport ReactDOM from 'react-dom';\n\n// Chart margins\nconst margin = {top: 0, right: 35, bottom: 20, left: 25};\nconst yBufferTop = 1.2;\nconst numTicksX = (width) => (width < 480 ? 4 : 6);\n\nfunction TimeseriesBrush({\n  timeseries,\n  dates,\n  brushDomain,\n  endDate,\n  setBrushEnd,\n  setLookback,\n}) {\n  const chartRef = useRef();\n  const wrapperRef = useRef();\n  const dimensions = useResizeObserver(wrapperRef);\n\n  // Dimensions\n  const {width, height} = dimensions ||\n    wrapperRef.current?.getBoundingClientRect() || {\n      width: margin.left + margin.right,\n      height: margin.bottom + margin.top,\n    };\n\n  const xScale = useMemo(() => {\n    const T = dates.length;\n\n    // Chart extremes\n    const chartRight = width - margin.right;\n\n    return scaleTime()\n      .clamp(true)\n      .domain([\n        parseIndiaDate(dates[0] || endDate),\n        parseIndiaDate(dates[T - 1] || endDate),\n      ])\n      .range([margin.left, chartRight]);\n  }, [width, endDate, dates]);\n\n  useEffect(() => {\n    // Chart extremes\n    const chartBottom = height - margin.bottom;\n\n    const xAxis = (g) =>\n      g\n        .attr('class', 'x-axis')\n        .call(axisBottom(xScale).ticks(numTicksX(width)));\n\n    const timeseriesStacked = stack()\n      .keys(BRUSH_STATISTICS)\n      .value((date, statistic) =>\n        Math.max(0, getStatistic(timeseries[date], 'total', statistic))\n      )(dates);\n\n    const yScale = scaleLinear()\n      .clamp(true)\n      .domain([\n        0,\n        max(\n          timeseriesStacked[timeseriesStacked.length - 1],\n          ([, y1]) => yBufferTop * y1\n        ),\n      ])\n      .range([chartBottom, margin.top]);\n\n    const svg = select(chartRef.current);\n    const t = svg.transition().duration(D3_TRANSITION_DURATION);\n\n    svg\n      .select('.x-axis')\n      .attr('pointer-events', 'none')\n      .style('transform', `translateY(${chartBottom}px)`)\n      .transition(t)\n      .call(xAxis);\n\n    const areaPath = area()\n      .curve(curveMonotoneX)\n      .x((d) => xScale(parseIndiaDate(d.data)))\n      .y0((d) => yScale(d[0]))\n      .y1((d) => yScale(d[1]));\n\n    svg\n      .selectAll('.trend-area')\n      .data(timeseriesStacked)\n      .join(\n        (enter) =>\n          enter\n            .append('path')\n            .attr('class', 'trend-area')\n            .attr('fill', ({key}) => STATISTIC_CONFIGS[key].color + '99')\n            .attr('stroke', 'none')\n            .attr('d', areaPath)\n            .attr('pointer-events', 'none'),\n        (update) =>\n          update\n            .transition(t)\n            .attrTween('d', function (date) {\n              const previous = select(this).attr('d');\n              const current = areaPath(date);\n              return interpolatePath(previous, current);\n            })\n            .selection()\n      );\n  }, [dates, width, height, xScale, timeseries]);\n\n  const defaultSelection = brushDomain.map((date) =>\n    xScale(parseIndiaDate(date))\n  );\n\n  const brushed = useCallback(\n    ({sourceEvent, selection}) => {\n      if (!sourceEvent) return;\n      // if (!selection) {\n      //   const [[cx]] = pointers(event);\n      //   selection = [cx, cx];\n      //   select(this).call(brush.move, [cx, cx]);\n      // }\n      const [brushStartDate, brushEndDate] = selection.map(xScale.invert);\n\n      ReactDOM.unstable_batchedUpdates(() => {\n        setBrushEnd(formatISO(brushEndDate, {representation: 'date'}));\n        setLookback(differenceInDays(brushEndDate, brushStartDate));\n      });\n    },\n    [xScale, setBrushEnd, setLookback]\n  );\n\n  useEffect(() => {\n    const svg = select(chartRef.current);\n    // Chart extremes\n    const chartRight = width - margin.right;\n    const chartBottom = height - margin.bottom;\n\n    function beforebrushstarted(event) {\n      const selection = brushSelection(this.parentNode);\n      if (!selection) return;\n\n      const dx = selection[1] - selection[0];\n      const [[cx]] = pointers(event);\n      const [x0, x1] = [cx - dx / 2, cx + dx / 2];\n      const [X0, X1] = xScale.range();\n      select(this.parentNode).call(\n        brush.move,\n        x1 > X1 ? [X1 - dx, X1] : x0 < X0 ? [X0, X0 + dx] : [x0, x1]\n      );\n    }\n\n    function brushended({sourceEvent, selection}) {\n      if (!sourceEvent || !selection) return;\n      const domain = selection\n        .map(xScale.invert)\n        .map((date) => formatISO(date, {representation: 'date'}));\n\n      select(this)\n        .call(\n          brush.move,\n          domain.map((date) => xScale(parseIndiaDate(date)))\n        )\n        .call((g) => g.select('.overlay').attr('cursor', 'pointer'));\n    }\n\n    const brush = brushX()\n      .extent([\n        [margin.left, margin.top],\n        [chartRight, chartBottom],\n      ])\n      .on('start brush', brushed)\n      .on('end', brushended);\n\n    svg\n      .select('.brush')\n      .call(brush)\n      .call(brush.move, defaultSelection)\n      .call((g) =>\n        g\n          .select('.overlay')\n          .attr('cursor', 'pointer')\n          .datum({type: 'selection'})\n          .on('mousedown touchstart', beforebrushstarted)\n      );\n  }, [width, height, xScale, defaultSelection, brushed]);\n\n  return (\n    <div className=\"Timeseries\">\n      <div\n        className={classnames('svg-parent fadeInUp is-brush')}\n        ref={wrapperRef}\n      >\n        <svg ref={chartRef} preserveAspectRatio=\"xMidYMid meet\">\n          <g className=\"brush\" />\n          <g className=\"x-axis\" />\n        </svg>\n      </div>\n    </div>\n  );\n}\n\nconst isEqual = (prevProps, currProps) => {\n  if (!equal(currProps.brushDomain, prevProps.brushDomain)) {\n    return false;\n  } else if (\n    !equal(\n      currProps.regionHighlighted.stateCode,\n      prevProps.regionHighlighted.stateCode\n    )\n  ) {\n    return false;\n  } else if (\n    !equal(\n      currProps.regionHighlighted.districtName,\n      prevProps.regionHighlighted.districtName\n    )\n  ) {\n    return false;\n  } else if (!equal(currProps.endDate, prevProps.endDate)) {\n    return false;\n  } else if (!equal(currProps.dates, prevProps.dates)) {\n    return false;\n  }\n  return true;\n};\n\nexport default memo(TimeseriesBrush, isEqual);\n"],"sourceRoot":""}